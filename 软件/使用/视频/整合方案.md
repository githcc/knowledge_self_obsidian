## 台式电脑运行emby
1. 虚拟机：vmare17 Pro
2. 系统：centos7 170G
3. 网络：桥接

## 服务器运行xiaoya
1. 系统：腾讯云centos docker版
2. 小雅数量：2
3. 代理：clash

## 资源瓶颈
1. 网络
   1. 图片：服务带宽4M
   2. 视频：阿里云30M
      1. 使用直链，避免使用服务器地址时导致服务带宽成成为瓶颈
      2. 申请开发者可以突破30M，感觉没太必要
2. 性能
   1. 算力：台式电脑cpu vmare分配了4*2核
   2. io：台式电脑固态
   3. 解码：台式电脑cpu核显
   4. 内存：vmare分配了4G，首次安装可以拉高一些
3. 限制
   1. 小雅：服务器2个账号

## 妥协
1. 服务器大于40G的价格比较贵
   1. 本可以服务器运行emby，改为本地电脑运行emby
   2. 本地运行emby带来的问题：占用电脑资源，无法较好处理同步问题
2. xiaoya提供的emby不是开心版
   1. 本可以一键安装，免刮削
      1. 妥协1：本地手动刮削-使用元数据，费时，费力
      2. 妥协2：手动刮削-不适用元数据，界面信息少了许多

## 优化的地方
1. 小雅账号支持多个
2. 页面内容能够自定义且可以保留
3. 使用了开心版，支持转码
4. 链路细节清晰

## 理想情况
1. 小雅
   1. 支持配置多个用户，用更优雅的方式解决阿里限制问题
   2. embody.sh 的版本使用开心版，解决刮削的取舍
2. 服务器
   1. 更大且便宜的带宽
   2. 磁盘空间大于200G
   3. 服务器的cpu支持硬解(这个不大可能，还是买台nas)

## 下载资源
1. all.mp4
2. pikpak.mp4

## 处理资源
1. 改后缀为zip/7z，进行解压
2. 上传到相应位置
3. 修改资源路径
   ```
   find /media/xiaoya -type f -name '*.strm' -exec sed -i 's#http://xiaoya.host:5678//#http://xiaoya.host:5678/#g' {} +
   ```

## 开核显
1. 进行授权
2. 将硬件加速设置为高级，可能需要重启
```
ls /dev/dri
chmod 777 /dev/dri/renderD128
```

## 安装emby特别版
```
docker run -d \
-v /media/xiaoya:/media     \
-v /media/config:/config/root/default     \
--restart=always  \
--device=/dev/dri:/dev/dri \
--name Emby -p 8096:8096 -p 8920:8920 lovechen/embyserver:latest
```

## 安装jellyfin(不建议)
[dockerhub](https://hub.docker.com/r/nyanmisaka/jellyfin)
[google drive](https://drive.google.com/drive/folders/1qO2l5Z12nMC7-GHLNEw299N16YdJVdON)

## 使用直链
```
docker cp ./externalPlayer.js xiaoya:/etc/nginx/http.d
```

## 参考资料
1. csdn
   1. [Emby 开心版](https://blog.csdn.net/ruoyusixian/article/details/130878493)
2. 什么值得买
   1. [Emby开心版硬解](https://post.smzdm.com/p/awkk3nzk/)